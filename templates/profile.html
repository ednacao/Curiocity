{% extends 'base.html' %}
{% block head %}
    <title>Profile</title>
    <link rel="stylesheet" href="../static/css/cover.css">
{% endblock %}
{% block body %}

	<div id='map-two' class='map pad2'>Map</div>
	<div>
		<table style="width:100%">
		<tr>
			<td>Name:</td><td> {{ location.name }}</td><br>
		<tr>
			<td>Address:</td><td> {{ location.address }}</td><br>
		<tr>
			<td>Description:</td><td> {{ location.description }}</td><br>
		<tr>
			<td>Hours:</td><td> {{ location.hours }}</td><br>
		<tr>
			<td>Seating Info:</td><td> {{ location.seating_info }}</td><br>
		<tr>
			<td>Food Info:</td><td> {{ location.food_info }}</td><br>
		<tr>
			<td>Restrooms?</td><td> {{ location.restrooms }}</td><br>
		<tr>
			<td>Food?</td><td> {{ location.food_yn }}</td><br>
		<tr>
			<td>Seating?</td><td> {{ location.seating_yn}}</td><br>
		<br>
		<tr>
			<td>Current Location is</td><td>Latitude: {{ lat }}, Longitude: {{ long }}</td>
		</tr>
	</table>
	</div>
	<div>
		<img src="{{ image.url }}" ></img>
	</div>
	<!-- placeholder map for lay	out reference -->
	<script>
	var latitude = Number("{{ lat }}");
	var longitude = Number("{{ long }}");
	var profile_latitude = Number("{{ location.profile_latitude }}");
	var profile_longitude = Number("{{ location.profile_longitude }}");

	// THIS IS THE PUBLIC ACCESS TOKEN!!!		// THIS IS THE PUBLIC ACCESS TOKEN!!!
	L.mapbox.accessToken = "pk.eyJ1IjoiZWNhbyIsImEiOiJHVEFEM1NnIn0.6hb7Mp5jlFNiu22rsZkDUg";
	var map = L.mapbox.map('map-two', 'ecao.lce9cd80')
	//center on lat, long with zoom level 13
	.setView([latitude, longitude], 15);

	// Disable zoom handlers.
	map.touchZoom.disable();
	map.scrollWheelZoom.disable();

	var featureLayer = L.mapbox.featureLayer()
    .addTo(map);

    // alert("HEY MEGGIE, UR NOT CRAY");

	featureLayer.setGeoJSON([
		
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
	    {
	    	type: 'Feature',
	    	geometry: {
		        type: 'Point',
		        // coordinates here are in longitude, latitude order because
		        // x, y is the standard for GeoJSON and many formats
		        coordinates: [
		          longitude,
		          latitude 
		        ]
	    	},
		    properties: {
		        title: 'Current Location',
		        description: [longitude, latitude],
		        // one can customize markers by adding simplestyle properties
		        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
		        'marker-size': 'medium',
		        'marker-color': '#82CCB3',
		        'marker-symbol': 'triangle'
			}
		},
		{
			type: 'Feature',
		    geometry: {
		        type: 'Point',
		        // coordinates here are in longitude, latitude order because
		        // x, y is the standard for GeoJSON and many formats
		        coordinates: [
		          profile_longitude,
		          profile_latitude 
		        ]
		    },
		    properties: {
		        title: '{{location.name}}',
		        description: [profile_longitude, profile_latitude],
		        // one can customize markers by adding simplestyle properties
		        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
		        'marker-size': 'medium',
		        'marker-color': '#E60000',
		        'marker-symbol': 'triangle'
		    }
		}
	]).addTo(map);

	// getWaypoints();


    // map.on('click', function(e) {
    //     // Let's add a callback to makeMarker so that it can draw the route only
    //     // *after* it's done processing the marker adding.
    //     makeMarker(e, drawRoute);
    // });


	// FIX ME -- ASSIGN FUNCTION TO VAR AND PARSE OUT JSON TO GET WAYPOINTS THAT WILL BE A PARAM FOR THE VAR LINE_POINTS
	function getDirections(){
		// alert("I'm inside getDirections()!");
		$.getJSON("http://api.tiles.mapbox.com/v4/directions/mapbox.driving/" + longitude + "," + latitude + ";" + profile_longitude + "," + profile_latitude + ".json?access_token=pk.eyJ1IjoiZWNhbyIsImEiOiJHVEFEM1NnIn0.6hb7Mp5jlFNiu22rsZkDUg", function(data){
			parseData(data);
			
			console.log("http://api.tiles.mapbox.com/v4/directions/mapbox.walking/" + longitude + "," + latitude + ";" + profile_longitude + "," + profile_latitude + ".json?access_token=pk.eyJ1IjoiZWNhbyIsImEiOiJHVEFEM1NnIn0.6hb7Mp5jlFNiu22rsZkDUg")
		});
	}
	getDirections();



	function parseData(data){
		// alert("DATA IN PARSEDATA() WUT");
		console.log(data);

		var route = data.routes[0].geometry.coordinates;
		route = route.map(function(point){
			return [point[1], point[0]];
		});
		polyline.setLatLngs(route);
	}



	// var directionPolyline = getDirections()
	// var directionsTwo = directionPolyline;




	//FIX ME -- need to popular line_points with declared variables
    var line_points = [
    [latitude, longitude],
    [profile_latitude, profile_longitude],
	];

	// Defining a polygon here instead of a polyline will connect the
	// endpoints and fill the path.
	// http://leafletjs.com/reference.html#polygon
	var polyline = L.polyline(line_points, polyline_options).addTo(map);

	// Define polyline options
	// http://leafletjs.com/reference.html#polyline
	var polyline_options = {
	    color: '#C33'
	};	

    // var waypoints = [];
    // var polyline = L.polyline([]).addTo(map);
    // function makeMarker(e, done) {
    //     var marker = L.marker(e.latlng, { draggable: true }).addTo(map);
    //     marker.on('dragend', drawRoute);
    //     waypoints.push(marker);
    //     return done();
    // }

    // function drawRoute() {
    //     if (waypoints.length < 2) return;
    //     // Directions API request looks like
    //     // http://api.tiles.mapbox.com/v4/directions/mapbox.driving/
    //     //    -122.42,37.78;-77.03,38.91.json?access_token={access_token}
    //     // We'll construct this using latlngs from the markers in waypoints.
    //     var points = waypoints.map(function(marker) {
    //         var latlng = marker._latlng;
    //         return [latlng.lng, latlng.lat].join(',');
    //     }).join(';');

    //     var directionsUrl = 'http://api.tiles.mapbox.com/v4/directions/mapbox.driving/' +
    //     points + '.json?access_token=' + L.mapbox.accessToken;

    //     $.get(directionsUrl, function(data) {
    //         // Do something with the directions returned from the API.
    //         var route = data.routes[0].geometry.coordinates;
    //         route = route.map(function(point) {
    //             // Turns out if we zoom out we see that the lat/lngs are flipped,
    //             // which is why it didn't look like they were being added to the
    //             // map. We can invert them here before drawing.
    //             return [point[1], point[0]];
    //         });
    //         polyline.setLatLngs(route);
    //     });
    // }

	</script>


{% endblock %}


